# Alloy Analyzerを軽く使ってみたよ.

## なんの話か?

* 仕事で設計してますよね?
  => ホワイトボードの前で大抵はER図もどきを
     (設計と一口に言っても広いですが,今回は主にモデルについて)

* 対象となるモデルを考えるときER図で満足しがち
  => DBスキーマはモデルの全てではない

* 決めるべきはValidなモデル

* "Valid"とはそれを処理するプログラムが想定範囲とすべき構造
  => DBスキーマだけだとゆるい
     - バリデーションロジック
     - 運用で回避
     - UIで制限 etc.
  => それを全て受けいれようとするとモデルを扱うロジックは非常に複雑になる
  => モデルをリファインするとともに関係者で共通認識を


## Alloy Analyzerとは

* "軽量"形式手法

* 有界モデル発見器

* PhD. D.Jackson(MIT)が公開している自動解析ツール

## Alloyの特徴

## 形式手法って?

* E.W.Dijkstraのお言葉(1972.チューリング賞受賞講演)

  "プログラム・テスティングはバグがあることを示す効果的な方法になるが，バグがないことを示すことは絶望的である."
  => 顧客に言われたらこの言葉を贈ろう.

* 形式手法の目的はバグがないことを示す技術の確立
  => 理想は分かるけど現実は...

## *軽量*形式手法

* 定理証明 => 個人的には非常に楽しいが手間がかかる
  Agdaのコード例
  * そう言えば,強い型付けも形式手法に含めて考える(ことがある)

* "軽量と"は形式的仕様と非形式的なプログラム(水準0) by Wikipedia

## 動かしてみる

* これはチュートリアルなので単なるサンプルです.
* 目的はどういうものか?を実際に使ってみせる.

## 仕事で使ってみた

* OPERA
  CRAGEの見積書の構造
  受注(見積書)の構造
  請求処理における状態遷移
  承認プロセスの状態遷移
  ログイン処理における状態遷移

## 知見

* Alloyさんは有能なレビュアー
  * 人間にツッコミ入れられるとイヤだがAlloyのツッコミは楽しい.
* 顧客に対して具体的な構造を挙げて有効(Valid)と考えるのかどうか議論できる.
* 顧客に対して確認すべきことが網羅できている安心感.
* モデルを仕様化する上で明記すべきものが明確になる.

* Alloyさんは設計をしてくれるわけではない
* 状態遷移的なものは手間が急速に大きくなる気がする
* 本は出版されたがあまりWebには情報が少ない
* 数値や文字列などのリテラル表現が不自由
  * ツールは他にもあるので今後試していきたい
