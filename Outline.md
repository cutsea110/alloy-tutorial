# Alloy Analyzerを軽く使ってみたよ.

## 本日のトピック

* モデル設計
 => みんなでホワイトボード前に集ってわいわいやってるあれ
    設計とひとくちに言っても広範囲
    今回は主にモデルについて

* テーブルスキーマで満足しがち
  スキーマでほぼ決まる(という錯覚)
  => 一歩進んでValidなモデルを手に入れよう!

* Validなモデル(orデータ)?
  プログラムが処理対象と想定しているもの
  正当なデータの構成

  * DBスキーマ
  * バリデーションロジック
  * 運用でお約束
  * UIで制限


* Valid 明確にしてる?

  - 根拠や必要性は曖昧
  - それで十分なのか

* Valid 何によって支持されるか?

  なんでもかんでも制限すれば良いわけではない

  顧客の要求する"機能・性質"を保証すること

  例)  併願可能
       合格は高々ひとつしかない
       請求漏れがない
       二重請求はない

## Alloy Analyzerとは

* "軽量"形式手法のツール

* 有界モデル発見器

* 抽象化・設計で利用

## 形式手法って?

* E.W.Dijkstraのお言葉(1972.チューリング賞受賞講演)

  "プログラム・テスティングはバグがあることを示す効果的な方法になるが，バグがないことを示すことは絶望的である."
  => 顧客「また不具合だよっ!ちゃんとテストしてるんですか!？(怒」といわれたら。

* 形式手法の目的はバグがないことを示す技術の確立

## *軽量*形式手法

* 背景

  * 定理証明のような形式手法
    => 手間がかかりすぎる

    => "完全"に拘りすぎでは...
       もう少し現場で手軽に使えるものを

* 軽量とは

  * "軽量"とは形式的仕様と非形式的なプログラム(水準0) by Wikipedia
    形式仕様記述から開発・検証までするには枝葉末節まで記述せねばならずツライ
    => もっと"ゆるふわ"形式手法,もっと"なんちゃって"形式手法で

  * 様々なアプローチがあるらしい.
    強い型付けをする型システムなんかもそう.
    モデル検査だとか...

    その中でもごく一部
      モデル発見器 Alloyを紹介

## Alloyの特徴

* 分かりやすいグラフィカル表示
  Themeによる見た目のカスタマイズ

* 莫大な空間を探索
  - テストでは到底不可能なカバレッジを実現

* 小スコープ仮説
  不具合の原因となる構造は小さな構成要素でも再現可能

* 対話的な評価環境
  Evalでのデバッグ

* 矛盾するファクトを指摘可能
  MiniSat with Unsat Coreを使える環境であれば.



## 動かしてみる

* 眠くなりそうなんで能書きは以下略
  とっとと動かしてみよう.
  教科書のような綺麗な例は自習で.

## 仕事で使ってみた

* OPERA
  -- 見積書の構造について
  CRAGEの見積書の構造

  受注(見積書)の構造
  請求処理における状態遷移
  承認プロセスの状態遷移
  ログイン処理における状態遷移

* koreka
  教育課程 - 学年教育課程の構造

* force
  入試の構造

## 知見(感想)

* Alloyさんは有能な"レビュアー"
  Alloyさんは設計をしてくれるわけではない

* 具体的な構造を挙げて有効(Valid)と考えるのかどうか議論できる.
* 確認すべきことが網羅できている安心感.
* モデルの仕様において必要十分な記述を明確にできる.

* 状態遷移的なものは手間が大きくなる気がする
  => 量化子の扱いを間違えると御判断の素
  => 証明でもそうだが命題そのものを間違ってしまう

* 現実には静的なモデル検査で留めるのがコスパが良いと思う.
  => 状態遷移などは別のツールか?

* 本は出版されたがあまりWebには情報が少ない

* 数値や文字列などのリテラル表現が不自由
  Intは使えるが例えば合計が等しくなるとか貸借が等しくなるなど...
  モデル検査としては構造的なものがメインで値のValidityは抽象の段階で埋もれる.

  Intの代替にenumが使えるが類似のパターンが多数生成されるのが邪魔.

## オチ

* そういえばAlloy Analyzer更新されてなくない
  => [hola](http://alloy.mit.edu/alloy/hola/)

  Alloy*: A Higher-Order Relational Constraint Solver

  permits higher-order quantification:
  changes the **semantics** of Alloy only by expanding the set of specifications
  that can be analyzed

  => 新章突入ってこと?!

